<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Janky Earth Defense</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/paper.js/0.12.1/paper-core.js"></script>
    <script src="./src/meteors.js" type="text/javascript"></script>
    <link rel="stylesheet" href="./src/game.css" />
  </head>
  <body>
    <canvas
      id="myCanvas"
      width="600px"
      height="600px"
      style="background-color: black"
    >
    </canvas>
    <!-- <canvas id="paperCanvas" width="600px" height="600px"> </canvas> -->
    <script type="text/javascript" canvas="myCanvas">
      // paper.install(window);
      // window.onload = function() {
      //   paper.setup("paperCanvas");
      //   var tool = new Tool();

      //   tool.onMouseDown = function(event) {
      //     if (pathArray.length < 5) {
      //       path = new Path();
      //       path.strokeColor = "white";
      //       path.add(event.point);
      //       debugger;
      //     }
      //   };

      //   tool.onMouseDrag = function(event) {
      //     path.add(event.point);
      //   };
      //   tool.onMouseUp = function(event) {
      //     pathArray.push(path);
      //     path.remove();
      //   };
      // };

      var canvas = document.getElementById("myCanvas");
      var ctx = canvas.getContext("2d");
      var meteor = new Meteor();
      var meteorArray = [];

      var circleRadius = 20;
      var x = 0;
      var y = 0;
      var dx = 1;
      var dy = 1;
      var myPath;
      var numMeteors = 5;
      var line = { startX: 0, startY: 0, endX: 0, endY: 0 };
      var lineArray = [];

      canvas.addEventListener("mousedown", handleMousedown);
      canvas.addEventListener("mouseup", handleMouseup);

      function handleMousedown(e) {
        if (lineArray.length < 5) {
          line.startX = e.x;
          line.startY = e.y;
        }
      }

      function handleMouseup(e) {
        if (lineArray.length < 5) {
          line.endX = e.x;
          line.endY = e.y;
          lineArray.push(line);
          line = { startX: 0, startY: 0, endX: 0, endY: 0 };
        }
      }

      function drawLine() {
        for (var i = 0; i < lineArray.length; i++) {
          ctx.strokeStyle = "white";
          ctx.beginPath();
          ctx.moveTo(lineArray[i].startX, lineArray[i].startY);
          ctx.lineTo(lineArray[i].endX, lineArray[i].endY);
          ctx.lineWidth = 2;
          ctx.stroke();
        }
      }

      function increaseMeteors() {
        numMeteors += 1;
      }

      function createMeteors() {
        if (meteorArray.length < numMeteors) {
          var side = Math.floor(Math.random() * 4);
          var x;
          var y;
          var center = 300;
          switch (side) {
            case 0:
              y = 0;
              x = Math.random() * 600;
              break;
            case 1:
              y = Math.random() * 600;
              x = 600;
              break;
            case 2:
              y = 600;
              x = Math.random() * 600;
              break;
            case 3:
              y = Math.random() * 600;
              x = 0;
              break;
          }
          var directionX = x - 300;
          var directionY = y - 300;

          var hypot = Math.sqrt(
            directionX * directionX + directionY * directionY
          );

          directionX /= hypot;
          directionY /= hypot;

          meteorArray.push(new Meteor(y, x, directionX, directionY));
        }
      }

      function drawMeteors() {
        for (var i = 0; i < meteorArray.length; i++) {
          if (
            meteorArray[i].x > 280 &&
            meteorArray[i].x < 320 &&
            (meteorArray[i].y > 280 && meteorArray[i].y < 320)
          ) {
            meteorArray.splice(i, 1);
          }
          meteorArray[i].drawMeteor();
        }
      }

      function drawCircle() {
        ctx.beginPath();
        ctx.arc(300, 300, circleRadius, 0, Math.PI * 2);
        ctx.fillStyle = "green";
        ctx.fill();
        ctx.closePath();
      }

      function draw() {
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        drawCircle();
        drawMeteors();
        drawLine();
      }

      setInterval(createMeteors, 1000);
      setInterval(draw, 10);
    </script>
  </body>
</html>
